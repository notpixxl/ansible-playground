# {{ ansible_managed }}
#  Listen for connections on all interfaces (both IPv4 *and* IPv6)
agentAddress {{ snmpd_agent_address | join(',') }}
###############################################################################
#
#  ACCESS CONTROL
#
#  system + hrSystem groups only

view systemonly included .1.3.6.1.2.1.1
view systemonly included .1.3.6.1.2.1.25.1

#  Full access from the local host
#rocommunity public  localhost

#  Default access to basic system info
rocommunity {{ snmpd_community | join (' ') }}

#  rocommunity6 is for IPv6
rocommunity6 public  default   -V systemonly

rouser authOnlyUser

###############################################################################
#
#  SYSTEM INFORMATION
#

#  Note that setting these values here, results in the corresponding MIB objects being 'read-only'
#  See snmpd.conf(5) for more details

sysLocation {{ snmpd_sys_location }}
sysContact  {{ snmpd_sys_contact }}
sysDescr  {{ snmpd_sys_description }}

#
#  Disk Monitoring
#
# 10% free on all disks

{% if snmpd_disks_include_all %}
includeAllDisks {{ snmpd_disks_include_all_threshold }}
{% endif %}
{% for snmpd_disk in snmpd_disks %}
disk {{ snmpd_disk.path }} {{ snmpd_disk.threshold }}
{% endfor %}

defaultMonitors         {{ 'yes' if snmpd_default_monitors else 'no' }}
linkUpDownNotifications {{ 'yes' if snmpd_link_up_down_notifications else 'no' }}

{% for snmpd_extension in snmpd_extensions | default([]) %}
extend {{ snmpd_extension.name }} {{ snmpd_extension.prog }} {{ snmpd_extension.args | default([]) | join(' ') }}
{% endfor %}

#  AgentX Sub-agents
#
#  Run as an AgentX master agent

master agentx